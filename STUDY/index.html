<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>STUDYKURT</title>
<style>
    body { font-family: Arial, sans-serif; margin:0; background:#f4f4f9; color:#000; transition: background 0.3s, color 0.3s;}
    header { background:#4a90e2; color:white; padding:20px; text-align:center; font-size:2em; position: relative;}
    #settingsBtn { position: absolute; top:20px; right:20px; background: none; border:none; font-size:1.5em; color:white; cursor:pointer; }
    main { padding:20px; max-width:900px; margin:auto; transition: background 0.3s, color 0.3s;}
    .button { background:#4a90e2; color:white; border:none; padding:15px 25px; margin:10px; font-size:1em; cursor:pointer; border-radius:5px; transition: background 0.3s;}
    .button:hover { background:#357ab8; }
    #uploadSection, #flashcardsSection, #mockTestSection { display:none; margin-top:20px; }
    .flashcard, .question { padding:15px; margin:10px 0; border:1px solid #4a90e2; border-radius:5px; cursor:pointer; transition: background 0.3s, color 0.3s;}
    .flashcard-answer { display:none; margin-top:10px; color:#555; }
    #loading { display:none; font-weight:bold; color:#4a90e2; }
    /* Dark Mode */
    body.dark { background:#121212; color:#e0e0e0;}
    body.dark header { background:#1f1f1f; color:#e0e0e0;}
    body.dark .button { background:#333; color:#e0e0e0; }
    body.dark .button:hover { background:#555; }
    body.dark .flashcard, body.dark .question { border-color:#555; background:#1f1f1f; color:#e0e0e0; }
    body.dark #loading { color:#4a90e2; }
</style>
</head>
<body>

<header>
    STUDYKURT
    <button id="settingsBtn" onclick="toggleDarkMode()">⚙️</button>
</header>

<main>
    <!-- Home Buttons -->
    <div id="home">
        <button class="button" onclick="showSection('flashcards')">Flashcards</button>
        <button class="button" onclick="showSection('mockTest')">Mock Test</button>
    </div>

    <!-- PDF Upload -->
    <div id="uploadSection">
        <h2 id="uploadLabel"></h2>
        <input type="file" id="pdfUpload" accept="application/pdf"><br>
        <button class="button" onclick="processPDF()">Generate</button>
        <p id="loading">Processing PDF and generating content, please wait...</p>
    </div>

    <!-- Flashcards Output -->
    <div id="flashcardsSection">
        <h2>Flashcards</h2>
        <div id="flashcardsContainer"></div>
    </div>

    <!-- Mock Test Output -->
    <div id="mockTestSection">
        <h2>Mock Test</h2>
        <div id="mockTestContainer"></div>
    </div>
</main>

<!-- PDF.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.8.162/pdf.min.js"></script>
<script>
let currentMode = ""; // "flashcards" or "mockTest"

// Dark Mode Toggle
function toggleDarkMode() {
    document.body.classList.toggle('dark');
}

// Show appropriate section
function showSection(mode) {
    currentMode = mode;
    document.getElementById('home').style.display = 'none';
    document.getElementById('uploadSection').style.display = 'block';
    document.getElementById('uploadLabel').textContent = "Upload PDF for " + (mode === 'flashcards' ? "Flashcards" : "Mock Test");
}

// Extract text from PDF
async function extractPDFText(file) {
    const pdfData = await file.arrayBuffer();
    const pdf = await pdfjsLib.getDocument({data: pdfData}).promise;
    let fullText = '';
    for (let i = 1; i <= pdf.numPages; i++) {
        const page = await pdf.getPage(i);
        const content = await page.getTextContent();
        const strings = content.items.map(item => item.str);
        fullText += strings.join(' ') + '\n';
    }
    return fullText;
}

// Call OpenAI API
async function callOpenAI(prompt) {
    const response = await fetch('https://api.openai.com/v1/chat/completions', {
        method:'POST',
        headers:{
            'Content-Type':'application/json',
            'Authorization':'Bearer YOUR_OPENAI_API_KEY'
        },
        body: JSON.stringify({
            model: "gpt-3.5-turbo",
            messages: [{role:"user", content: prompt}],
            temperature: 0.7,
            max_tokens: 1000
        })
    });
    const data = await response.json();
    return data.choices[0].message.content;
}

// Process PDF and generate content
async function processPDF() {
    const file = document.getElementById('pdfUpload').files[0];
    if(!file) { alert("Please upload a PDF"); return; }
    document.getElementById('loading').style.display = 'block';

    const text = await extractPDFText(file);
    let prompt = "";

    if(currentMode === "flashcards") {
        prompt = `Generate 10 simple flashcards from this text. Format each as "Front: ... Back: ..." \nText:\n${text}`;
    } else {
        prompt = `Generate 10 multiple-choice mock test questions from this text. Format each as "Q: ... Choices: A) ... B) ... C) ... D) ... Answer: ..." \nText:\n${text}`;
    }

    try {
        const result = await callOpenAI(prompt);
        displayResult(result);
    } catch(err) {
        alert("Error generating content: " + err);
    }
    document.getElementById('loading').style.display = 'none';
}

// Display flashcards or mock test
function displayResult(resultText) {
    if(currentMode === "flashcards") {
        const container = document.getElementById('flashcardsContainer');
        container.innerHTML = '';
        const cards = resultText.split('\n').filter(line=>line.trim().startsWith("Front:"));
        cards.forEach(card => {
            const [frontPart, backPart] = card.split("Back:");
            const div = document.createElement('div');
            div.className = 'flashcard';
            div.innerHTML = `${frontPart}<div class="flashcard-answer">${backPart}</div>`;
            div.addEventListener('click', ()=> {
                const ans = div.querySelector('.flashcard-answer');
                ans.style.display = ans.style.display==='block'?'none':'block';
            });
            container.appendChild(div);
        });
        document.getElementById('flashcardsSection').style.display = 'block';
    } else {
        const container = document.getElementById('mockTestContainer');
        container.innerHTML = '';
        const questions = resultText.split('\n').filter(line=>line.trim().startsWith("Q:"));
        questions.forEach(q => {
            const div = document.createElement('div');
            div.className = 'question';
            div.innerHTML = q.replace(/\n/g,'<br>') + '<hr>';
            container.appendChild(div);
        });
        document.getElementById('mockTestSection').style.display = 'block';
    }
}
</script>

</body>
</html>
